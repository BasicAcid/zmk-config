/*
* Copyright (c) 2020 The ZMK Contributors
*

* SPDX-License-Identifier: MIT
*/

#include <behaviors.dtsi>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/bt.h>
#include "keymap_french.h"

/ {
    keymap {
        compatible = "zmk,keymap";

        // Layer 0: AZERTY Base Layout (letters only, modifiers unchanged)
        default_layer {
            display-name = "AZERTY";
            bindings = <
                // TOP ROW: A Z E R T Y U I O P (AZERTY letter layout)
                &kp TAB    &kp Q  &kp W  &kp E  &kp R  &kp T      &kp Y     &kp U     &kp I  &kp O      &kp P  &kp BSPC

                // MIDDLE ROW (HOME ROW): Q S D F G H J K L M (AZERTY home row)
                &kp LSHFT  &kp A  &kp S  &kp D  &kp F  &kp G      &kp H     &kp J     &kp K  &kp L      &kp SEMI  &kp RSHIFT

                // BOTTOM ROW: W X C V B N (AZERTY bottom letters)
                &kp LCTRL  &kp Z  &kp X  &kp C  &kp V  &kp B      &kp N     &kp M     &kp COMMA  &kp DOT  &kp SLASH  &kp RCTRL

                // THUMB KEYS: Keep the same modifier layout
                                         &kp LALT  &kp LCTRL  &kp LGUI   &mo 1  &kp SPACE  &mo 2
            >;
        };

        // Layer 1: Navigation Layer (Orange "Nav" - exactly as you specified)
        nav_layer {
            display-name = "Nav";
            bindings = <
                // TOP ROW: tab ⇱ up ⇲ PUp | / 7 8 9 (empty)
                &none       &kp TAB   &kp HOME  &kp UP    &kp END   &kp PG_UP  &kp FSLH    &kp N7    &kp N8    &kp N9    &none     &none

                // MIDDLE ROW: ⇪ lft dwn rgt PDn | - 4 5 6 0
                &trans      &kp CAPS  &kp LEFT  &kp DOWN  &kp RIGHT &kp PG_DN  &kp MINUS   &kp N4    &kp N5    &kp N6    &kp N0    &trans

                // BOTTOM ROW: ~ v- mut v+ DEL | , 1 2 3 .
                &trans      &kp TILDE &kp C_VOL_DN &kp C_MUTE &kp C_VOL_UP &kp DEL  &kp COMMA   &kp N1    &kp N2    &kp N3    &kp DOT   &trans

                // Thumb keys
                                                &trans    &trans    &trans     &trans      &trans    &trans
            >;
        };

        // Layer 2: AltGr Layer (Blue - exactly as you specified)
        symbols_layer {
            display-name = "AltGr";
            bindings = <
                // TOP ROW: ^ < > $ % | @ & * ' `
                &none       &kp CARET &kp LT    &kp GT    &kp DLLR  &kp PRCNT  &kp AT      &kp AMPS  &kp ASTRK &kp SQT   &kp GRAVE &none

                // MIDDLE ROW: { ( ) } = | \ + - / "
                &trans      &kp LBRC  &kp LPAR  &kp RPAR  &kp RBRC  &kp EQUAL  &kp BSLH    &kp PLUS  &kp MINUS &kp FSLH  &kp DQT   &trans

                // BOTTOM ROW: ~ [ ] ? # | | ! ; : ?
                &trans      &kp TILDE &kp LBKT  &kp RBKT  &kp QMARK &kp HASH   &kp PIPE    &kp EXCL  &kp SEMI  &kp COLON &kp QMARK &trans

                // Thumb keys
                                                &trans    &trans    &trans     &trans      &trans    &trans
            >;
        };

        // Layer 3: Bluetooth & System (when both layer keys are held)
        system_layer {
            display-name = "System";
            bindings = <
                // Bluetooth controls
                &bt BT_CLR  &bt BT_SEL 0  &bt BT_SEL 1  &bt BT_SEL 2  &bt BT_SEL 3  &bt BT_SEL 4    &none  &none  &none  &none  &none  &none

                // System controls
                &none       &none         &none         &none         &none         &none           &none  &none  &none  &none  &none  &none

                // Reset and bootloader
                &none       &none         &none         &none         &none         &none           &none  &none  &none  &none  &none  &bootloader

                // Thumb keys
                                                        &trans        &trans        &trans          &trans &trans &trans
            >;
        };
    };

    conditional_layers {
        compatible = "zmk,conditional-layers";

        // Access system layer when both nav and symbols are active
        tri_layer {
            if-layers = <1 2>;
            then-layer = <3>;
        };
    };
};
